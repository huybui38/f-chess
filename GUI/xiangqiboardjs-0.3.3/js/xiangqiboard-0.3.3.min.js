/* @license
 * xiangqiboard.js v0.3.3
 * https://github.com/lengyanyu258/xiangqiboardjs/
 *
 * Copyright (c) 2017, Chris Oakman
 * Copyright (c) 2018-2020, @lengyanyu258
 * Released under the MIT license
 * https://github.com/lengyanyu258/xiangqiboardjs/blob/master/LICENSE.md
 */
!function(){"use strict";const e=window.jQuery,n=Object.freeze("abcdefghi".split("")),t=v("rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR"),o=Object.freeze({clearfix:"clearfix-5f3b5",board:"board-1ef78",square:"square-2b8ce",highlight1:"highlight1-e13fc",highlight2:"highlight2-e0a03",notation:"notation-8c7a2",alpha:"alpha-f4ef2",numeric:"numeric-fe76e",row:"row-cb702",piece:"piece-1e8b9",sparePieces:"spare-pieces-9e77b",xiangqiboard:"xiangqiboard-8ddcb",sparePiecesTop:"spare-pieces-top-e4b47",sparePiecesBottom:"spare-pieces-bottom-29dac"});function r(e,n,t){let o=0,r=!1,i=[];const a=function(){o=0,r&&(r=!1,s())},s=function(){o=window.setTimeout(a,n),e.apply(t,i)};return function(e){i=arguments,o?r=!0:s()}}function i(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,(function(e){return(16*Math.random()|0).toString(16)}))}function a(e){return JSON.parse(JSON.stringify(e))}function s(e){const n=e.split(".");return{major:parseInt(n[0],10),minor:parseInt(n[1],10),patch:parseInt(n[2],10)}}function c(e,n){for(const t in n){if(!n.hasOwnProperty(t))continue;const o="{"+t+"}",r=n[t];for(;-1!==e.indexOf(o);)e=e.replace(o,r)}return e}function p(e){return"string"==typeof e}function u(e){return"function"==typeof e}function f(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function l(e){return"fast"===e||"slow"===e||!!f(e)&&e>=0}function d(e){if(!p(e))return!1;const n=e.split("-");return 2===n.length&&(h(n[0])&&h(n[1]))}function h(e){return p(e)&&-1!==e.search(/^[a-i][0-9]$/)}function g(e){if(!p(e))return!1;const t=(e=function(e){return e.replace(/9/g,"111111111").replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11")}(e=e.replace(/ .+$/,""))).split("/");if(10!==t.length)return!1;for(let e=0;e<10;e++)if(t[e].length!==n.length||-1!==t[e].search(/[^kabnrcpKABNRCP1]/))return!1;return!0}function b(n){if(!e.isPlainObject(n))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(!h(e)||(!p(t=n[e])||-1===t.search(/^[br][KABNRCP]$/))))return!1;var t;return!0}function m(){return typeof window.$&&e.fn&&e.fn.jquery&&(n=e.fn.jquery,t="1.8.3",n=s(n),t=s(t),1e5*n.major*1e5+1e5*n.minor+n.patch>=1e5*t.major*1e5+1e5*t.minor+t.patch);var n,t}function w(e){const n=e.split("");return"b"===n[0]?n[1].toLowerCase():n[1].toUpperCase()}function v(e){if(!g(e))return!1;const t=(e=e.replace(/ .+$/,"")).split("/"),o={};let r=9;for(let e=0;e<10;e++){const a=t[e].split("");let s=0;for(let e=0;e<a.length;e++)if(-1!==a[e].search(/[1-9]/)){s+=parseInt(a[e],10)}else{o[n[s]+r]=(i=a[e]).toLowerCase()===i?"b"+i.toUpperCase():"r"+i.toUpperCase(),s+=1}r-=1}var i;return o}function y(e){if(!b(e))return!1;let t="",o=9;for(let r=0;r<10;r++){for(let r=0;r<n.length;r++){const i=n[r]+o;e.hasOwnProperty(i)?t+=w(e[i]):t+="1"}9!==r&&(t+="/"),o-=1}return t=function(e){return e.replace(/111111111/g,"9").replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}(t),t}function P(e,t){const o=e.split(""),r=n.indexOf(o[0])+1,i=parseInt(o[1],10),a=t.split(""),s=n.indexOf(a[0])+1,c=parseInt(a[1],10),p=Math.abs(r-s),u=Math.abs(i-c);return p>=u?p:u}function x(e,t,o){const r=function(e){const t=[];for(let o=0;o<n.length;o++)for(let r=0;r<10;r++){const i=n[o]+r;e!==i&&t.push({square:i,distance:P(e,i)})}t.sort((function(e,n){return e.distance-n.distance}));const o=[];for(let e=0;e<t.length;e++)o.push(t[e].square);return o}(o);for(let n=0;n<r.length;n++){const o=r[n];if(e.hasOwnProperty(o)&&e[o]===t)return o}return!1}function q(e,n){const t=a(e);for(const e in n){if(!n.hasOwnProperty(e))continue;if(!t.hasOwnProperty(e))continue;const o=t[e];delete t[e],t[n[e]]=o}return t}function O(e){var n;return"black"!==e.orientation&&(e.orientation="red"),!0!==e.showNotation&&(e.showNotation=!1),!0!==e.draggable&&(e.draggable=!1),"trash"!==e.dropOffBoard&&(e.dropOffBoard="snapback"),!0!==e.sparePieces&&(e.sparePieces=!1),e.sparePieces&&(e.draggable=!0),e.hasOwnProperty("pieceTheme")&&(p(e.pieceTheme)||u(e.pieceTheme))||(e.pieceTheme="img/xiangqipieces/wikimedia/{piece}.svg"),e.hasOwnProperty("boardTheme")&&p(e.boardTheme)||(e.boardTheme="img/xiangqiboards/wikimedia/xiangqiboard.svg"),l(e.appearSpeed)||(e.appearSpeed=200),l(e.moveSpeed)||(e.moveSpeed=200),l(e.snapbackSpeed)||(e.snapbackSpeed=60),l(e.snapSpeed)||(e.snapSpeed=30),l(e.trashSpeed)||(e.trashSpeed=100),f(n=e.dragThrottleRate)&&n>=1||(e.dragThrottleRate=20),e}window.Xiangqiboard=function(s,f){if(!function(){if(!m()){const e="Xiangqiboard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.8.3 or higher on the page\n\nExiting...";return window.alert(e),!1}return!0}())return null;let l=function(n){if(""===n){const e="Xiangqiboard Error 1001: The first argument to Xiangqiboard() cannot be an empty string.\n\nExiting...";return window.alert(e),!1}p(n)&&"#"!==n.charAt(0)&&(n="#"+n);const t=e(n);if(1!==t.length){const e="Xiangqiboard Error 1003: The first argument to Xiangqiboard() must be the ID of a DOM node, an ID query selector, or a single DOM node.\n\nExiting...";return window.alert(e),!1}return t}(s);if(!l)return null;f=O(f=function(n){return"start"===n?n={position:a(t)}:g(n)?n={position:v(n)}:b(n)&&(n={position:a(n)}),e.isPlainObject(n)||(n={}),n}(f));let w=null,P=null,T=null,S=null;const k={};let E=2,C="red",X={},j=null,B=null,I=null,M=!1;const N={},D={};let R={},A=16;function Y(e,n,t){if(!0!==f.hasOwnProperty("showErrors")||!1===f.showErrors)return;let o="Xiangqiboard Error "+e+": "+n;return"console"===f.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(o),void(arguments.length>=2&&console.log(t))):"alert"===f.showErrors?(t&&(o+="\n\n"+JSON.stringify(t)),void window.alert(o)):void(u(f.showErrors)&&f.showErrors(e,n,t))}function K(e){return u(f.pieceTheme)?f.pieceTheme(e):c(f.pieceTheme,{piece:e})}function L(e,n,t){let r='<img src="'+K(e)+'" ';return p(t)&&""!==t&&(r+='id="'+t+'" '),r+='alt="" class="{piece}" data-piece="'+e+'" style="width:'+A+"px;height:"+A+"px;",n&&(r+="display:none;"),r+='" />',c(r,o)}function z(e){let n=["rK","rA","rB","rN","rR","rC","rP"];"black"===e&&(n=["bK","bA","bB","bN","bR","bC","bP"]);let t="";for(let e=0;e<n.length;e++)t+=L(n[e],!1,N[n[e]]);return t}function $(n,t,r,a){const s=e("#"+D[n]),c=s.offset(),p=e("#"+D[t]),l=p.offset(),d=i();e("body").append(L(r,!0,d));const h=e("#"+d);h.css({display:"",position:"absolute",top:c.top,left:c.left}),s.find("."+o.piece).remove();const g={duration:f.moveSpeed,complete:function(){p.append(L(r)),h.remove(),u(a)&&a()}};h.animate(l,g)}function U(n,t,r){const a=e("#"+N[n]).offset(),s=e("#"+D[t]),c=s.offset(),p=i();e("body").append(L(n,!0,p));const l=e("#"+p);l.css({display:"",position:"absolute",left:a.left,top:a.top});const d={duration:f.moveSpeed,complete:function(){s.find("."+o.piece).remove(),s.append(L(n)),l.remove(),u(r)&&r()}};l.animate(c,d)}function J(n,t,r){if(0===n.length)return;let i=0;function s(){i+=1,i===n.length&&(F(),u(f.onMoveEnd)&&f.onMoveEnd(a(t),a(r)))}for(let t=0;t<n.length;t++){const r=n[t];"clear"===r.type?e("#"+D[r.square]+" ."+o.piece).fadeOut(f.trashSpeed,s):"add"!==r.type||f.sparePieces?"add"===r.type&&f.sparePieces?U(r.piece,r.square,s):"move"===r.type&&$(r.source,r.destination,r.piece,s):e("#"+D[r.square]).append(L(r.piece,!0)).find("."+o.piece).fadeIn(f.appearSpeed,s)}}function Q(e,n){e=a(e),n=a(n);const t=[],o={};for(const t in n)n.hasOwnProperty(t)&&e.hasOwnProperty(t)&&e[t]===n[t]&&(delete e[t],delete n[t]);for(const r in n){if(!n.hasOwnProperty(r))continue;const i=x(e,n[r],r);i&&(t.push({type:"move",source:i,destination:r,piece:n[r]}),delete e[i],delete n[r],o[r]=!0)}for(const e in n)n.hasOwnProperty(e)&&(t.push({type:"add",square:e,piece:n[e]}),delete n[e]);for(const n in e)e.hasOwnProperty(n)&&(o.hasOwnProperty(n)||(t.push({type:"clear",square:n,piece:e[n]}),delete e[n]));return t}function F(){w.find("."+o.piece).remove();for(const n in X)X.hasOwnProperty(n)&&e("#"+D[n]).append(L(X[n]))}function W(){w.html(function(e){"black"!==e&&(e="red");let t="";const r=a(n);let i=9;"black"===e&&(r.reverse(),i=0);for(let o=0;o<10;o++){t+='<div class="{row}">';for(let o=0;o<n.length;o++){const n=r[o]+i;t+='<div class="{square} square-'+n+'" style="width:'+A+"px;height:"+A+'px;" id="'+D[n]+'" data-square="'+n+'">',f.showNotation&&(("red"===e&&0===i||"black"===e&&9===i)&&(t+='<div class="{notation} {alpha}">'+r[o]+"</div>"),0===o&&(t+='<div class="{notation} {numeric}">'+i+"</div>")),t+="</div>"}t+='<div class="{clearfix}"></div></div>',"red"===e?i-=1:i+=1}return c(t,o)}(C,f.showNotation)),w.css(function(e){"black"!==e&&(e="red");const n={};return n.background='url("'+f.boardTheme+'") no-repeat',n["background-size"]="100%",n}(C)),F(),f.sparePieces&&("black"===C?(T.html(z("red")),S.html(z("black"))):(T.html(z("black")),S.html(z("red"))))}function G(e){const n=a(X),t=a(e);y(n)!==y(t)&&(u(f.onChange)&&f.onChange(n,t),X=e)}function H(e,n){for(const t in R){if(!R.hasOwnProperty(t))continue;const o=R[t];if(e>=o.left&&e<o.left+A&&n>=o.top&&n<o.top+A)return t}return"offboard"}function V(){w.find("."+o.square).removeClass(o.highlight1+" "+o.highlight2)}function Z(){V();const e=a(X);delete e[I],G(e),F(),P.fadeOut(f.trashSpeed),M=!1}function _(n,t,r,i){u(f.onDragStart)&&!1===f.onDragStart(n,t,a(X),C)||(M=!0,j=t,I=n,B="spare"===n?"offboard":n,function(){R={};for(const n in D)D.hasOwnProperty(n)&&(R[n]=e("#"+D[n]).offset())}(),P.attr("src",K(t)).css({display:"",position:"absolute",left:r-A/2,top:i-A/2}),"spare"!==n&&e("#"+D[n]).addClass(o.highlight1).find("."+o.piece).css("display","none"))}function ee(n,t){P.css({left:n-A/2,top:t-A/2});const r=H(n,t);r!==B&&(h(B)&&e("#"+D[B]).removeClass(o.highlight2),h(r)&&e("#"+D[r]).addClass(o.highlight2),u(f.onDragMove)&&f.onDragMove(r,B,I,j,a(X),C),B=r)}function ne(n){let t="drop";if("offboard"===n&&"snapback"===f.dropOffBoard&&(t="snapback"),"offboard"===n&&"trash"===f.dropOffBoard&&(t="trash"),u(f.onDrop)){const e=a(X);"spare"===I&&h(n)&&(e[n]=j),h(I)&&"offboard"===n&&delete e[I],h(I)&&h(n)&&(delete e[I],e[n]=j);const o=a(X),r=f.onDrop(I,n,j,e,o,C);"snapback"!==r&&"trash"!==r||(t=r)}"snapback"===t?function(){if("spare"===I)return void Z();V();const n=e("#"+D[I]).offset(),t={duration:f.snapbackSpeed,complete:function(){F(),P.css("display","none"),u(f.onSnapbackEnd)&&f.onSnapbackEnd(j,I,a(X),C)}};P.animate(n,t),M=!1}():"trash"===t?Z():"drop"===t&&function(n){V();const t=a(X);delete t[I],t[n]=j,G(t);const o=e("#"+D[n]).offset(),r={duration:f.snapSpeed,complete:function(){F(),P.css("display","none"),u(f.onSnapEnd)&&f.onSnapEnd(I,n,j)}};P.animate(o,r),M=!1}(n)}function te(e){e.preventDefault()}function oe(n){if(!f.draggable)return;const t=e(this).attr("data-square");h(t)&&X.hasOwnProperty(t)&&_(t,X[t],n.pageX,n.pageY)}function re(n){if(!f.draggable)return;const t=e(this).attr("data-square");h(t)&&X.hasOwnProperty(t)&&(n=n.originalEvent,_(t,X[t],n.changedTouches[0].pageX,n.changedTouches[0].pageY))}function ie(n){if(!f.sparePieces)return;_("spare",e(this).attr("data-piece"),n.pageX,n.pageY)}function ae(n){if(!f.sparePieces)return;_("spare",e(this).attr("data-piece"),(n=n.originalEvent).changedTouches[0].pageX,n.changedTouches[0].pageY)}k.clear=function(e){k.position({},e)},k.destroy=function(){l.html(""),P.remove(),l.unbind()},k.fen=function(){return k.position("fen")},k.flip=function(){return k.orientation("flip")},k.move=function(){if(0===arguments.length)return X;let e=!0;const n={};for(let t=0;t<arguments.length;t++){if(!1===arguments[t]){e=!1;continue}if(!d(arguments[t])){Y(2826,"Invalid move passed to the move method.",arguments[t]);continue}const o=arguments[t].split("-");n[o[0]]=o[1]}const t=q(X,n);return k.position(t,e),t},k.orientation=function(e){return 0===arguments.length||(C="flip"===e?"black"===C?"red":"black":"black"!==e?"red":e,W()),C},k.position=function(e,n){if(0===arguments.length)return a(X);if(p(e)&&"fen"===e.toLowerCase())return y(X);if(p(e)&&"start"===e.toLowerCase()&&(e=a(t)),g(e)&&(e=v(e)),b(e))if(!1!==n&&(n=!0),n){J(Q(X,e),X,e),G(e)}else G(e),F();else Y(6482,"Invalid value passed to the position method.",e)},k.resize=function(){A=function(){let e=parseInt(l.width(),10);if(!e||e<=0)return 0;let t=e-1;for(;t%n.length!=0&&t>0;)t-=1;return t/n.length}(),w.css("width",A*n.length+"px"),P.css({height:A,width:A}),f.sparePieces&&l.find("."+o.sparePieces).css("paddingLeft",A+E+"px"),W()},k.start=function(e){k.position("start",e)};const se=r((function(e){M&&ee(e.pageX,e.pageY)}),f.dragThrottleRate),ce=r((function(e){M&&(e.preventDefault(),ee(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}),f.dragThrottleRate);function pe(e){if(!M)return;ne(H(e.pageX,e.pageY))}function ue(e){if(!M)return;ne(H(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function fe(n){if(M)return;if(!u(f.onMouseoverSquare))return;const t=e(n.currentTarget).attr("data-square");if(!h(t))return;let o=!1;X.hasOwnProperty(t)&&(o=X[t]),f.onMouseoverSquare(t,o,a(X),C)}function le(n){if(M)return;if(!u(f.onMouseoutSquare))return;const t=e(n.currentTarget).attr("data-square");if(!h(t))return;let o=!1;X.hasOwnProperty(t)&&(o=X[t]),f.onMouseoutSquare(t,o,a(X),C)}return C=f.orientation,f.hasOwnProperty("position")&&("start"===f.position?X=a(t):g(f.position)?X=v(f.position):b(f.position)?X=a(f.position):Y(7263,"Invalid value passed to config.position.",f.position)),function(){!function(){for(let e=0;e<n.length;e++)for(let t=0;t<=9;t++){const o=n[e]+t;D[o]=o+"-"+i()}const e="KABNRCP".split("");for(let n=0;n<e.length;n++){const t="r"+e[n],o="b"+e[n];N[t]=t+"-"+i(),N[o]=o+"-"+i()}}(),l.html(function(e){let n='<div class="{xiangqiboard}">';return e&&(n+='<div class="{sparePieces} {sparePiecesTop}"></div>'),n+='<div class="{board}"></div>',e&&(n+='<div class="{sparePieces} {sparePiecesBottom}"></div>'),n+="</div>",c(n,o)}(f.sparePieces)),w=l.find("."+o.board),f.sparePieces&&(T=l.find("."+o.sparePiecesTop),S=l.find("."+o.sparePiecesBottom));const t=i();e("body").append(L("rP",!0,t)),P=e("#"+t),E=parseInt(w.css("borderLeftWidth"),10),k.resize()}(),function(){e("body").on("mousedown mousemove","."+o.piece,te),w.on("mousedown","."+o.square,oe),l.on("mousedown","."+o.sparePieces+" ."+o.piece,ie),w.on("mouseenter","."+o.square,fe).on("mouseleave","."+o.square,le);const n=e(window);n.on("mousemove",se).on("mouseup",pe),"ontouchstart"in document.documentElement&&(w.on("touchstart","."+o.square,re),l.on("touchstart","."+o.sparePieces+" ."+o.piece,ae),n.on("touchmove",ce).on("touchend",ue))}(),k},window.Xiangqiboard.fenToObj=v,window.Xiangqiboard.objToFen=y}();